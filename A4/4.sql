/*
    Question 4:
    Strategy:
        - Create a table that contains student who's marks are over 98
          where their CNO,TERM,SECTION and SNO are recorded with that mark (TRY_HARD)
        - Then create the DISTINCT courses that these student whom got over 98 in (BIRD_COURSES)
        - By inner joinning BIRD_COURSES with Enrollment, we want to group CNO,TERM,SECTION
          and find each class's class average and then associate them with the course (ALL_MARKS)
        - Again, inner joinning ALL_MARKS with TRY_HARD from before, we can assocaite
          students that got over 98 in that course with the average of that course
        - Lastly, output the difference between the student's Mark with the class average
          as well as his/her SNO, and the class information

    Assumption:
        - I assumed that more than one student can be within TRY_HARD per course
        - I assumed that a student doesn't enroll in the same course two at different section
*/

CREATE TABLE TRY_HARD AS
SELECT SNO,CNO,MARK,TERM,SECTION
FROM Enrollment
GROUP BY SNO,CNO,TERM,SECTION
      HAVING MARK>98;

-- Table of all Courses that have students got over 98
CREATE TABLE BIRD_COURSES AS
SELECT DISTINCT CNO,TERM,SECTION
FROM TRY_HARD;

-- All of Bird course at section/term marks
CREATE TABLE ALL_MARKS AS
SELECT Enrollment.CNO AS CNO,Enrollment.TERM AS TERM,Enrollment.SECTION AS SECTION,AVG(MARK) as Average_Mark
FROM BIRD_COURSES INNER JOIN Enrollment ON 
     BIRD_COURSES.CNO=Enrollment.CNO AND
     BIRD_COURSES.TERM=Enrollment.TERM AND
     BIRD_COURSES.SECTION=Enrollment.SECTION
GROUP BY BIRD_COURSES.CNO,BIRD_COURSES.TERM,BIRD_COURSES.SECTION
;


CREATE TABLE TRY_AVG AS
SELECT *
FROM (TRY_HARD INNER JOIN ALL_MARKS ON
      TRY_HARD.CNO=ALL_MARKS.CNO AND
      TRY_HARD.TERM=ALL_MARKS.TERM AND
      TRY_HARD.SECTION=ALL_MARKS.SECTION);

SELECT SNO,CNO,MARK - Average_Mark
FROM TRY_AVG
ORDER BY SNO,CNO;


/* OUTPUT
20002939|CS482|19.625
20037890|PHYS255|17.3636363636364
20099883|CS488|14.0
20163094|CS247|14.5555555555556
20163094|PHYS497|17.3333333333333
20193175|CS449|16.0
20248082|CS350|17.3846153846154
20304343|MATH285|15.875
20458699|MATH210|14.375
20458853|PHYS451|12.1666666666667
20591079|PHYS420|13.1666666666667
20591079|PHYS451|19.5833333333333
20602987|CS312|15.125
20602987|CS458|17.9565217391304
20652458|PHYS364|12.7777777777778
20842491|PHYS484|14.1428571428571
20862191|MATH334|17.6666666666667
20936107|PHYS484|17.4615384615385
20938960|PHYS285|19.6923076923077
20954626|MATH395|12.8333333333333
21090840|PHYS193|14.6153846153846
21152057|PHYS289|14.5
21210918|CS485|19.0
21229888|PHYS124|20.28
21267773|PHYS124|20.28
21288103|PHYS451|12.1666666666667
21407646|PHYS263|17.2
21433509|PHYS446|13.0
21495049|PHYS458|15.4545454545455
21568625|MATH399|12.2
21646983|PHYS361|20.625
21649510|MATH459|13.1
21649510|PHYS221|12.3333333333333
21670504|PHYS485|10.5
21676293|CS488|16.625
21676293|MATH399|12.1
21750774|PHYS483|15.8181818181818
21767530|MATH261|18.0
21768045|MATH250|16.5714285714286
21818793|CS485|17.1818181818182
21821244|MATH491|14.4444444444444
21906995|CS432|16.0
21947461|CS316|18.1052631578947
21955374|CS484|12.9
21960289|PHYS414|14.3571428571429
21993697|MATH226|17.1111111111111
22046341|MATH452|12.6
22052239|PHYS255|18.1111111111111
22078262|MATH355|16.9166666666667
22215932|MATH217|17.4666666666667
22233056|MATH261|17.6315789473684
22289300|PHYS388|13.0
22296412|CS486|16.6
22318590|PHYS133|18.6
22468169|MATH479|14.0
22492414|CS314|17.3809523809524
22556132|CS489|14.5
22564251|CS476|14.5833333333333
22788590|CS312|14.9642857142857
22788590|CS487|17.5882352941177
23008065|PHYS485|14.3333333333333
23010891|MATH382|20.7647058823529
23049532|CS312|15.9642857142857
23067117|MATH192|17.8
23067117|MATH427|19.5714285714286
23193544|CS316|15.8333333333333
23214247|CS316|13.8125
23240776|PHYS312|16.7142857142857
23267930|PHYS271|16.5
23314441|MATH340|17.5
23357206|MATH459|13.3
23381814|CS213|18.3
23442335|CS436|17.5172413793103
23486913|CS370|17.6470588235294
23543938|PHYS460|13.8571428571429
23591313|PHYS484|14.625
23610816|CS211|18.3636363636364
23749666|CS218|18.4545454545455
23759303|PHYS147|12.9090909090909
23805142|CS247|14.3333333333333
24002271|CS486|17.7058823529412
24077663|PHYS368|16.6
24125617|MATH334|16.1428571428571
24163544|MATH245|14.5
24169469|MATH358|16.7777777777778
24176094|PHYS452|12.5
24236259|PHYS477|17.1818181818182
24287823|MATH427|15.8
24294227|CS348|17.8181818181818
24410026|CS215|17.875
24596751|MATH217|17.6363636363636
24613564|CS338|18.5714285714286
24637521|CS314|15.5454545454545
24676943|PHYS254|19.04
24860703|PHYS147|16.7333333333333
24885811|PHYS194|17.7058823529412
24886621|CS446|12.3
24888192|CS350|16.3846153846154
24989644|PHYS193|15.2
25129806|CS137|17.0
25132581|CS476|17.1363636363636
25286278|MATH192|18.7931034482759
25330788|MATH382|15.25
25365706|CS313|15.6666666666667
25664679|MATH424|17.0
25672769|CS436|15.2
25743829|MATH459|14.1
25799060|MATH362|17.8888888888889
25800239|CS135|17.6
25827649|PHYS420|11.4
25830348|PHYS254|14.2727272727273
25835768|MATH217|18.0
25984438|MATH441|19.6
25987170|PHYS398|18.9615384615385
26044854|CS450|15.5
26207553|PHYS478|16.0909090909091
26247302|PHYS244|13.8
26256419|MATH383|15.2857142857143
26342477|PHYS388|17.75
26523244|CS487|17.1428571428571
26570974|CS462|18.7142857142857
26607054|MATH358|14.8
26627237|MATH221|15.3333333333333
26653529|CS115|18.625
26698118|PHYS271|19.0
26836481|MATH381|16.875
27007594|PHYS271|15.6363636363636
27007594|PHYS317|17.8888888888889
27007594|PHYS458|19.5555555555556
27168359|PHYS420|17.6363636363636
27279702|CS490|15.0
27279702|PHYS290|16.8
27279702|PHYS485|15.9130434782609
27292661|MATH285|16.4444444444444
27357294|PHYS271|16.1428571428571
27386745|MATH192|16.6
27421447|MATH197|17.0952380952381
27464811|CS247|14.125
27493259|PHYS457|12.3571428571429
27532359|CS230|14.9
27657997|MATH375|14.5555555555556
27717039|MATH381|17.5
27722125|CS246|16.2222222222222
27729518|CS147|18.2222222222222
27729902|MATH382|15.5714285714286
27792707|PHYS255|18.1111111111111
27902980|PHYS484|18.4615384615385
28013643|CS146|15.0
28025345|MATH428|17.1666666666667
28192879|PHYS337|17.125
28231389|MATH459|12.3
28234450|MATH261|16.0
28284876|MATH399|17.8260869565217
28471310|PHYS257|19.2857142857143
28473457|MATH399|18.8260869565217
28513198|MATH226|15.8
28539436|CS240|18.2857142857143
28580040|CS458|21.1
28638811|PHYS474|18.5
28921899|PHYS414|13.8
29017604|PHYS455|16.7
29050897|MATH395|17.5714285714286
29067979|MATH399|13.1
29119934|CS240|10.75
29171697|MATH197|15.0
29466896|CS312|17.75
29501010|PHYS368|18.0
29507951|MATH452|15.0
29615296|PHYS317|20.0
29643474|CS211|11.5
29808557|PHYS254|18.04
29877646|CS230|13.0
*/
